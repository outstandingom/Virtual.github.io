
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AR Book – Camera Background</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
    }

    /* Live camera background */
    #video-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: 1;
    }

    /* Three.js canvas overlay */
    canvas {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 2;
      pointer-events: auto;
    }
  </style>
</head>

<body>

  <!-- Camera feed -->
  <video id="video-bg" autoplay playsinline muted></video>

  <script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three@0.132.2';
    import { GLTFLoader } from 'https://cdn.skypack.dev/three@0.132.2/examples/jsm/loaders/GLTFLoader.js';
    import { OrbitControls } from 'https://cdn.skypack.dev/three@0.132.2/examples/jsm/controls/OrbitControls.js';

    /* =======================
       1️⃣ START CAMERA
    ======================= */
    const video = document.getElementById('video-bg');

    navigator.mediaDevices.getUserMedia({
      video: { facingMode: { ideal: "environment" } },
      audio: false
    }).then(stream => {
      video.srcObject = stream;
    }).catch(err => {
      alert("Camera access denied");
      console.error(err);
    });

    /* =======================
       2️⃣ THREE.JS SETUP
    ======================= */
    const scene = new THREE.Scene();

    const camera = new THREE.PerspectiveCamera(
      70,
      window.innerWidth / window.innerHeight,
      0.01,
      100
    );
    camera.position.set(0, 0, 2);

    const renderer = new THREE.WebGLRenderer({
      alpha: true,
      antialias: true
    });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    document.body.appendChild(renderer.domElement);

    /* =======================
       3️⃣ ORBIT CONTROLS
       (ROTATION ONLY)
    ======================= */
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableZoom = false;
    controls.enablePan = false;
    controls.enableDamping = true;
    controls.dampingFactor = 0.08;
    controls.rotateSpeed = 0.6;

    /* =======================
       4️⃣ LIGHTING
    ======================= */
    scene.add(new THREE.AmbientLight(0xffffff, 1.5));
    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(2, 5, 5);
    scene.add(dirLight);

    /* =======================
       5️⃣ LOAD BOOK MODEL
    ======================= */
    let book;
    const loader = new GLTFLoader();

    loader.load('Blue%20Book.glb', gltf => {
      book = gltf.scene;
      book.position.set(0, -0.5, -1.5);
      scene.add(book);

      // Rotate around book center
      controls.target.copy(book.position);
      controls.update();
    }, undefined, error => {
      console.error("GLB load error:", error);
    });

    /* =======================
       6️⃣ RENDER LOOP
    ======================= */
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    /* =======================
       7️⃣ HANDLE RESIZE
    ======================= */
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>

</body>
</html>
